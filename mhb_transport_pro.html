<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MHB Transport Pro ‚Äî Passenger Transport Operations (Tamil Nadu)</title>
    <meta name="description" content="Enterprise passenger transport ‚Äî realtime, compliant, profitable.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons (using simple SVG icons inline for performance/single-file requirement, or a minimal CDN if allowed. Using inline SVGs for critical icons to ensure standalone) -->
    
    <style>
        /* --- CSS Variables & Reset --- */
        :root {
            --primary: #0f172a; /* Deep Navy */
            --primary-light: #1e293b;
            --accent: #f97316; /* Saffron/Orange */
            --accent-hover: #ea580c;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --radius: 0.5rem;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); line-height: 1.5; -webkit-font-smoothing: antialiased; }
        
        /* --- Utility Classes --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .hidden { display: none; }
        .block { display: block; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-white { color: #fff; }
        .text-primary { color: var(--primary); }
        .text-accent { color: var(--accent); }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-muted { color: var(--text-muted); }
        .bg-white { background-color: var(--bg-card); }
        .bg-primary { background-color: var(--primary); }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .rounded { border-radius: var(--radius); }
        .shadow { box-shadow: var(--shadow-sm); }
        .border { border: 1px solid var(--border); }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .cursor-pointer { cursor: pointer; }
        
        /* --- Components --- */
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border-radius: var(--radius); font-weight: 500; transition: all 0.2s; border: none; cursor: pointer; font-size: 0.875rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: var(--primary-light); }
        .btn-accent { background-color: var(--accent); color: white; }
        .btn-accent:hover { background-color: var(--accent-hover); }
        .btn-outline { border: 1px solid var(--border); background: transparent; color: var(--text-main); }
        .btn-outline:hover { background-color: var(--bg-body); }
        .btn-sm { padding: 0.25rem 0.75rem; font-size: 0.75rem; }

        .card { background: var(--bg-card); border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border); overflow: hidden; }
        .card-header { padding: 1rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background-color: #f8fafc; }
        .card-body { padding: 1rem; }

        .badge { display: inline-flex; align-items: center; padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background-color: #dcfce7; color: #166534; }
        .badge-warning { background-color: #fef3c7; color: #92400e; }
        .badge-danger { background-color: #fee2e2; color: #991b1b; }
        .badge-info { background-color: #e0f2fe; color: #075985; }

        .input { width: 100%; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius); font-family: inherit; font-size: 0.875rem; }
        .input:focus { outline: 2px solid var(--primary); border-color: transparent; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .modal { background: white; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; border-radius: var(--radius); box-shadow: var(--shadow-md); transform: translateY(20px); transition: transform 0.2s; }
        .modal-overlay.open .modal { transform: translateY(0); }

        /* --- Layout Specifics --- */
        header { background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 40; }
        .nav-link { color: var(--text-muted); text-decoration: none; padding: 0.5rem; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; }
        .nav-link:hover, .nav-link.active { color: var(--primary); background: #f1f5f9; border-radius: var(--radius); }
        
        .map-container { background-color: #e5e7eb; height: 500px; position: relative; overflow: hidden; border-radius: var(--radius); }
        .map-marker { position: absolute; width: 24px; height: 24px; transform: translate(-50%, -50%); transition: all 1s linear; cursor: pointer; }
        
        .timeline-item { position: relative; padding-left: 2rem; padding-bottom: 1.5rem; border-left: 2px solid var(--border); }
        .timeline-item:last-child { border-left: transparent; }
        .timeline-dot { position: absolute; left: -0.55rem; top: 0; width: 1rem; height: 1rem; border-radius: 50%; background: white; border: 2px solid var(--primary); }
        .timeline-dot.active { background: var(--success); border-color: var(--success); }

        /* Responsive */
        @media (max-width: 1024px) {
            .grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-cols-3 { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .grid-cols-4, .grid-cols-3, .grid-cols-2 { grid-template-columns: 1fr; }
            .flex-col-mobile { flex-direction: column; }
            .sidebar { display: none; } /* Simplified for mobile */
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="shadow-sm">
        <div class="container py-2">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-primary rounded flex items-center justify-center text-white font-bold">M</div>
                        <div>
                            <h1 class="font-bold text-primary leading-tight">MHB Transport Pro</h1>
                            <p class="text-xs text-muted">Passenger Transport Operations (Tamil Nadu)</p>
                        </div>
                    </div>
                    <div class="hidden md:flex gap-4 ml-8 text-sm border-l pl-4 border-slate-200">
                        <div><span class="text-muted">Today:</span> <span class="font-semibold">482 bookings</span></div>
                        <div><span class="text-muted">Active:</span> <span class="font-semibold text-success">389 vehicles</span></div>
                        <div><span class="text-muted">On-time:</span> <span class="font-semibold text-success">92%</span></div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button class="btn btn-outline btn-sm" onclick="downloadSpec()">Download Spec</button>
                    <button class="btn btn-accent btn-sm">Request Demo</button>
                    <div class="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center font-bold text-muted cursor-pointer" title="Admin User">A</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container py-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Left Sidebar (Navigation) -->
        <aside class="hidden lg:block lg:col-span-2 space-y-2">
            <a href="#" class="nav-link active"><span>üìä</span> Dashboard</a>
            <a href="#" class="nav-link"><span>üó∫Ô∏è</span> Live Map</a>
            <a href="#" class="nav-link"><span>üìÖ</span> Bookings</a>
            <a href="#" class="nav-link"><span>üöò</span> Fleet</a>
            <a href="#" class="nav-link"><span>üë®‚Äç‚úàÔ∏è</span> Drivers</a>
            <a href="#" class="nav-link"><span>üìã</span> Compliance</a>
            <a href="#" class="nav-link"><span>üí∞</span> Finance</a>
            <a href="#" class="nav-link"><span>‚öôÔ∏è</span> Settings</a>
            
            <div class="mt-8 p-4 bg-slate-100 rounded text-xs text-muted">
                <p class="font-semibold mb-1">Tamil Nadu Ops</p>
                <p>Permit Renewals: <span class="text-warning">3 pending</span></p>
                <p>FC Expiry: <span class="text-success">All Valid</span></p>
            </div>
        </aside>

        <!-- Center Content (Dashboard & Map) -->
        <main class="lg:col-span-7 space-y-6">
            
            <!-- KPI Strip (Mobile visible) -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="card p-4">
                    <p class="text-xs text-muted font-semibold uppercase">Revenue (Est)</p>
                    <p class="text-xl font-bold text-primary">‚Çπ 4.2L</p>
                    <p class="text-xs text-success">‚Üë 12% vs yest</p>
                </div>
                <div class="card p-4">
                    <p class="text-xs text-muted font-semibold uppercase">Utilization</p>
                    <p class="text-xl font-bold text-primary">88%</p>
                    <p class="text-xs text-warning">High Demand</p>
                </div>
                <div class="card p-4">
                    <p class="text-xs text-muted font-semibold uppercase">Safety Score</p>
                    <p class="text-xl font-bold text-success">98/100</p>
                    <p class="text-xs text-muted">2 minor alerts</p>
                </div>
                <div class="card p-4">
                    <p class="text-xs text-muted font-semibold uppercase">Pending</p>
                    <p class="text-xl font-bold text-accent">14</p>
                    <p class="text-xs text-muted">Need dispatch</p>
                </div>
            </div>

            <!-- Live Map -->
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold">Live Fleet View (Chennai Region)</h3>
                    <div class="flex gap-2">
                        <select class="input py-1 text-xs w-auto">
                            <option>All Types</option>
                            <option>Sedan</option>
                            <option>SUV</option>
                            <option>Bus</option>
                        </select>
                        <button class="btn btn-outline btn-sm">Filter</button>
                    </div>
                </div>
                <div class="map-container" id="map-root">
                    <!-- Map markers injected by JS -->
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #94a3b8; font-size: 2rem; opacity: 0.2; font-weight: bold;">
                        Interactive Map Layer
                    </div>
                </div>
                <div class="card-body flex justify-between text-xs text-muted">
                    <div class="flex gap-4">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-success"></span> Active</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-warning"></span> Idle</span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-danger"></span> Maintenance</span>
                    </div>
                    <div>Updated: <span id="last-updated">Just now</span></div>
                </div>
            </div>

            <!-- Intelligent Dispatch Panel -->
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold">Pending Dispatches</h3>
                    <span class="badge badge-warning">14 Pending</span>
                </div>
                <div class="card-body">
                    <div class="space-y-3" id="dispatch-list">
                        <!-- Dispatch items injected by JS -->
                    </div>
                </div>
            </div>

        </main>

        <!-- Right Sidebar (Actions & Context) -->
        <aside class="lg:col-span-3 space-y-6">
            
            <!-- Quick Booking -->
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="font-semibold text-sm">Quick Booking</h3>
                </div>
                <div class="card-body space-y-3">
                    <div>
                        <label class="text-xs font-semibold text-muted">Passenger Category</label>
                        <select class="input mt-1" id="pax-category">
                            <option value="regular">Regular Staff</option>
                            <option value="vip">VIP / Executive</option>
                            <option value="vvip">VVIP (Director)</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs font-semibold text-muted">Pax Count</label>
                            <input type="number" class="input mt-1" value="1" min="1" id="pax-count">
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-muted">Vehicle</label>
                            <input type="text" class="input mt-1 bg-slate-100" value="Sedan" readonly id="suggested-vehicle">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-semibold text-muted">Add-ons</label>
                        <div class="flex flex-wrap gap-2 mt-1">
                            <label class="flex items-center gap-1 text-xs cursor-pointer"><input type="checkbox"> Water</label>
                            <label class="flex items-center gap-1 text-xs cursor-pointer"><input type="checkbox"> Newspaper</label>
                            <label class="flex items-center gap-1 text-xs cursor-pointer"><input type="checkbox"> Wheelchair</label>
                        </div>
                    </div>
                    <div class="pt-2 border-t border-slate-100 flex justify-between items-center">
                        <div>
                            <p class="text-xs text-muted">Est. Price</p>
                            <p class="font-bold text-lg">‚Çπ <span id="est-price">450</span></p>
                        </div>
                        <button class="btn btn-accent btn-sm" onclick="createBooking()">Create Booking</button>
                    </div>
                </div>
            </div>

            <!-- Pre-Trip Checks -->
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold text-sm">Compliance & Safety</h3>
                </div>
                <div class="card-body space-y-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium">Driver Pre-Trip</p>
                            <p class="text-xs text-muted">Required before dispatch</p>
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="openChecklistModal()">Run Check</button>
                    </div>
                    <div class="h-px bg-slate-100"></div>
                    <div>
                        <p class="text-xs font-semibold text-muted mb-2">Fleet Health</p>
                        <div class="flex justify-between text-sm mb-1">
                            <span>Compliance</span>
                            <span class="text-success font-bold">98%</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-2">
                            <div class="bg-success h-2 rounded-full" style="width: 98%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold text-sm">Recent Alerts</h3>
                    <span class="text-xs text-danger font-bold">2 New</span>
                </div>
                <div class="card-body space-y-3">
                    <div class="flex gap-3 items-start">
                        <div class="text-xl">‚ö†Ô∏è</div>
                        <div>
                            <p class="text-sm font-medium text-danger">Speeding Alert</p>
                            <p class="text-xs text-muted">TN-01-AB-1234 ‚Ä¢ 110 km/h</p>
                            <p class="text-xs text-muted">2 mins ago ‚Ä¢ ECR Road</p>
                        </div>
                    </div>
                    <div class="flex gap-3 items-start">
                        <div class="text-xl">üí§</div>
                        <div>
                            <p class="text-sm font-medium text-warning">Fatigue Warning</p>
                            <p class="text-xs text-muted">Driver: Ramesh K.</p>
                            <p class="text-xs text-muted">Driving > 4hrs without break</p>
                        </div>
                    </div>
                </div>
            </div>

        </aside>

    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12 py-8">
        <div class="container">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-sm text-muted">
                    <p>&copy; 2024 MHB Transport Pro. All rights reserved.</p>
                    <p class="text-xs mt-1">Vehicle renewals & regulatory compliance tracked as per local Tamil Nadu transport laws.</p>
                </div>
                <div class="flex gap-4">
                    <span class="badge badge-info">ISO 27001</span>
                    <span class="badge badge-info">GDPR Compliant</span>
                    <span class="badge badge-info">TLS Encrypted</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal-overlay" id="checklist-modal">
        <div class="modal">
            <div class="card-header">
                <h3 class="font-bold text-lg">Pre-Trip Inspection (iAuditor Style)</h3>
                <button class="btn btn-outline btn-sm border-0" onclick="closeChecklistModal()">‚úï</button>
            </div>
            <div class="card-body space-y-4">
                <div class="bg-slate-50 p-3 rounded text-sm mb-4">
                    <p><strong>Vehicle:</strong> TN-05-XY-9876 (Innova Crysta)</p>
                    <p><strong>Driver:</strong> Suresh Kumar</p>
                </div>

                <div class="space-y-3">
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">Alcohol Test (Breathalyzer)</span>
                        <input type="checkbox" class="w-5 h-5 accent-success" required>
                    </label>
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">Documents (License, RC, Ins)</span>
                        <input type="checkbox" class="w-5 h-5 accent-success">
                    </label>
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">First Aid Kit & Fire Extinguisher</span>
                        <input type="checkbox" class="w-5 h-5 accent-success">
                    </label>
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">Tires & Brakes Check</span>
                        <input type="checkbox" class="w-5 h-5 accent-success">
                    </label>
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">Clean Cabin / No Smell</span>
                        <input type="checkbox" class="w-5 h-5 accent-success">
                    </label>
                    <label class="flex items-center justify-between p-2 border rounded hover:bg-slate-50 cursor-pointer">
                        <span class="font-medium">Fuel Level > 25%</span>
                        <input type="checkbox" class="w-5 h-5 accent-success">
                    </label>
                </div>

                <div class="mt-4">
                    <label class="block text-sm font-medium mb-1">Upload DVIR Photo (Front + Odometer)</label>
                    <div class="border-2 border-dashed border-slate-300 rounded p-4 text-center text-muted text-sm hover:bg-slate-50 cursor-pointer">
                        Click to capture or upload photo
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button class="btn btn-primary w-full" onclick="submitChecklist()">Submit & Dispatch</button>
                    <button class="btn btn-outline w-full" onclick="closeChecklistModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- Mock Data ---
        const VEHICLE_TYPES = ['Sedan', 'MPV', 'SUV', 'VVIP', 'Bus', 'Mini-wagon'];
        const LOCATIONS = [
            { name: 'Chennai Airport', lat: 12.9941, lng: 80.1709 },
            { name: 'T. Nagar', lat: 13.0418, lng: 80.2341 },
            { name: 'OMR IT Park', lat: 12.9692, lng: 80.2423 },
            { name: 'Guindy', lat: 13.0067, lng: 80.2206 },
            { name: 'Velachery', lat: 12.9815, lng: 80.2180 }
        ];

        // Generate 25 Mock Vehicles
        const vehicles = Array.from({ length: 25 }, (_, i) => ({
            id: `TN-${String(i+1).padStart(2, '0')}-AB-${1000+i}`,
            type: VEHICLE_TYPES[Math.floor(Math.random() * VEHICLE_TYPES.length)],
            status: Math.random() > 0.8 ? 'idle' : (Math.random() > 0.9 ? 'maintenance' : 'active'),
            lat: 13.0 + (Math.random() * 0.1),
            lng: 80.2 + (Math.random() * 0.1),
            heading: Math.random() * 360
        }));

        // Mock Pending Dispatches
        const pendingDispatches = [
            { id: 'B-1023', from: 'Chennai Airport', to: 'Grand Chola', pax: 'VIP', time: '10:30 AM' },
            { id: 'B-1024', from: 'Tidel Park', to: 'Tambaram', pax: 'Regular', time: '10:45 AM' },
            { id: 'B-1025', from: 'Central Station', to: 'Anna Nagar', pax: 'Regular', time: '11:00 AM' }
        ];

        // --- UI Logic ---

        // Map Simulation
        function initMap() {
            const mapRoot = document.getElementById('map-root');
            
            vehicles.forEach(v => {
                const marker = document.createElement('div');
                marker.className = 'map-marker';
                marker.innerHTML = getVehicleIcon(v.type, v.status);
                marker.style.left = `${(v.lng - 80.15) * 800}px`; // Simple projection mock
                marker.style.top = `${(13.1 - v.lat) * 800}px`;
                marker.id = `marker-${v.id}`;
                marker.title = `${v.id} (${v.type})`;
                mapRoot.appendChild(marker);
            });

            // Animate markers
            setInterval(() => {
                vehicles.forEach(v => {
                    if (v.status === 'active') {
                        v.lat += (Math.random() - 0.5) * 0.001;
                        v.lng += (Math.random() - 0.5) * 0.001;
                        
                        const el = document.getElementById(`marker-${v.id}`);
                        if (el) {
                            el.style.left = `${(v.lng - 80.15) * 800}px`;
                            el.style.top = `${(13.1 - v.lat) * 800}px`;
                        }
                    }
                });
                document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
            }, 3000);
        }

        function getVehicleIcon(type, status) {
            const color = status === 'active' ? '#10b981' : (status === 'maintenance' ? '#ef4444' : '#f59e0b');
            // Simple SVG icon
            return `<svg width="24" height="24" viewBox="0 0 24 24" fill="${color}" stroke="white" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 8v8M8 12h8" stroke="white" stroke-width="2" />
            </svg>`;
        }

        // Dispatch Panel
        function renderDispatches() {
            const container = document.getElementById('dispatch-list');
            container.innerHTML = pendingDispatches.map(d => `
                <div class="flex items-center justify-between p-3 border rounded hover:bg-slate-50">
                    <div>
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-sm">${d.id}</span>
                            <span class="badge ${d.pax === 'VIP' ? 'badge-warning' : 'badge-info'}">${d.pax}</span>
                        </div>
                        <p class="text-xs text-muted mt-1">${d.from} ‚Üí ${d.to}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-bold">${d.time}</p>
                        <button class="btn btn-primary btn-sm mt-1">Dispatch</button>
                    </div>
                </div>
            `).join('');
        }

        // Booking Form Logic
        document.getElementById('pax-category').addEventListener('change', updateBookingEst);
        document.getElementById('pax-count').addEventListener('input', updateBookingEst);

        function updateBookingEst() {
            const cat = document.getElementById('pax-category').value;
            const count = parseInt(document.getElementById('pax-count').value) || 1;
            
            let vehicle = 'Sedan';
            let price = 450;

            if (count > 4) vehicle = 'MPV';
            if (count > 7) vehicle = 'Mini-wagon';
            if (cat === 'vvip') vehicle = 'VVIP ' + vehicle;

            if (cat === 'vip') price *= 1.5;
            if (cat === 'vvip') price *= 2.5;
            if (count > 4) price *= 1.3;

            document.getElementById('suggested-vehicle').value = vehicle;
            document.getElementById('est-price').textContent = Math.round(price);
        }

        function createBooking() {
            alert('Booking Created! Dispatching to nearest driver...');
        }

        // Modal Logic
        function openChecklistModal() {
            document.getElementById('checklist-modal').classList.add('open');
        }
        function closeChecklistModal() {
            document.getElementById('checklist-modal').classList.remove('open');
        }
        function submitChecklist() {
            alert('Inspection Passed! Vehicle Dispatched.');
            closeChecklistModal();
        }

        // Spec Download
        function downloadSpec() {
            const spec = {
                projectName: "MHB Transport Pro",
                version: "1.0.0",
                region: "Tamil Nadu",
                features: {
                    phaseA: ["Landing", "Dashboard", "Live Map", "Booking", "Dispatch", "Pre-Trip Checklist"],
                    phaseB: ["Finance", "Maintenance", "Analytics"],
                    phaseC: ["AI Prediction", "Video Telematics"]
                },
                apiEndpoints: [
                    "GET /api/vehicles",
                    "POST /api/trips",
                    "POST /api/inspections"
                ],
                compliance: "Tamil Nadu Transport Dept Regulations"
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(spec, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "mhb-transport-pro-spec.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // Init
        window.addEventListener('DOMContentLoaded', () => {
            initMap();
            renderDispatches();
        });

    </script>
</body>
</html>
